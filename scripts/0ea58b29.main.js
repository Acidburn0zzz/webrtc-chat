(function(){$(document).ready(function(){var a,b,c,d,e,f,g,h,i,j;h={login:document.querySelector("#page-login"),caller:document.querySelector("#page-caller")};for(g in h)h[g].className+=" page";return h.login.className+=" active",window.pubnub=null,j=null,e=null,document.querySelector("#login").addEventListener("click",function(){return j=document.querySelector("#userid").value,window.pubnub=PUBNUB.init({publish_key:"pub-c-7070d569-77ab-48d3-97ca-c0c3f7ab6403",subscribe_key:"sub-c-49a2a468-ced1-11e2-a5be-02ee2ddab7fe",uuid:j}),pubnub.onNewConnection(function(a){return e?i(a):void 0}),h.login.className=h.login.className.replace("active",""),h.caller.className+=" active",$(document).trigger("pubnub:ready")}),b="",d=$("#answer-modal"),d.modal({show:!1}),i=function(a){return console.log("Publishing Stream!!!",a),pubnub.publish({user:a,stream:e}),pubnub.subscribe({user:a,stream:function(a,b){return console.log("Got stream:",b),document.querySelector("#call-video").src=URL.createObjectURL(b.stream)}})},a=function(a){return i(a),pubnub.publish({channel:"answer",message:{caller:b,callee:j}})},$(document).on("pubnub:ready",function(){return pubnub.subscribe({channel:"call",callback:function(a){return a.callee===j?(b=a.caller,f(a.caller)):void 0}}),pubnub.subscribe({channel:"answer",callback:function(a){return a.caller===j?i(a.callee):void 0}})}),f=function(a){return d.find(".caller").text(""+a+" is calling..."),d.modal("show")},d.find(".btn-primary").on("click",function(){return a(b),d.modal("hide")}),document.querySelector("#call").addEventListener("click",function(){var a;return a=document.querySelector("#other-userid").value,pubnub.publish({channel:"call",message:{caller:j,callee:a}})}),c=function(a){return document.querySelector("#self-call-video").src=URL.createObjectURL(a),e=a},navigator.webkitGetUserMedia({audio:!1,video:!0},c)})}).call(this);